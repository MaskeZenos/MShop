-- Is not my code here
ZonesListe = {
    ["LTD-Sud"] = {
        Position = vector3(-707.40, -914.74, 19.21),
        Public = true,
        Job = nil,
        Job2 = nil,
        Blip = {
            Name = "LTD Gasoline",
            Sprite = 52,
            Display = 4,
            Scale = 0.8,
            Color = 69
        },
        Action = function()
            TriggerEvent('openMagasin')
        end
    },
    ["LTD-Families"] = {
        Position = vector3(25.74, -1345.52, 29.49),
        Public = true,
        Job = nil,
        Job2 = nil,
        Blip = {
            Name = "247 Supermarket",
            Sprite = 52,
            Display = 4,
            Scale = 0.8,
            Color = 69
        },
        Action = function()
            TriggerEvent('openMagasin')
        end
    },
    ["LTD-Gs"] = {
     Position = vector3(-48.199, -1757.80, 29.42),
     Public = true,
     Job = nil,
     Job2 = nil,
     Blip = {
         Name = "LTD Gasoline",
         Sprite = 52,
         Display = 4,
         Scale = 0.8,
         Color = 69
     },
     Action = function()
         TriggerEvent('openMagasin')
     end
     },
     ["LTD-4"] = {
         Position = vector3(374.17, 327.80, 103.56),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-5"] = {
         Position = vector3(-1223.01, -907.29, 12.32),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "Robs Liquor",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-6"] = {
         Position = vector3(1135.59, -982.61, 46.41),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "Robs Liquor",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-7"] = {
         Position = vector3(-2967.84, 391.40, 15.04),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "Robs Liquor",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-8"] = {
         Position = vector3(-3041.06, 585.103, 7.90),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-9"] = {
         Position = vector3(-3244.08, 1001.32, 12.83),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-10"] = {
         Position = vector3(-1821.41, 793.88, 138.11),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "LTD Gasoline",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-11"] = {
         Position = vector3(1698.2601318359,4924.3442382812,42.063694000244),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "LTD Gasoline",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-12"] = {
         Position = vector3(1961.0549316406,3740.8920898438,32.343730926514),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-13"] = {
         Position = vector3(-1486.9412841797,-379.38009643555,40.163440704346),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "Robs Liquor",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-14"] = {
         Position = vector3(1163.5622558594,-323.66421508789,69.205047607422),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "LTD Gasoline",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-15"] = {
         Position = vector3(2556.3720703125,382.12768554688,108.62291717529),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-16"] = {
         Position = vector3(1166.0716552734,2709.3576660156,38.15771484375),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "Robs Liquor",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-17"] = {
         Position = vector3(547.82373046875,2670.9067382812,42.156532287598),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-18"] = {
         Position = vector3(2678.3679199219,3280.6831054688,55.241115570068),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-19"] = {
         Position = vector3(1729.1472167969,6414.927734375,35.037212371826),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "247 Supermarket",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     },
     ["LTD-20"] = {
         Position = vector3(1392.6323242188,3605.0432128906,34.980930328369),
         Public = true,
         Job = nil,
         Job2 = nil,
         Blip = {
             Name = "Robs Liquor",
             Sprite = 52,
             Display = 4,
             Scale = 0.8,
             Color = 69
         },
         Action = function()
             TriggerEvent('openMagasin')
         end
     }
}

function AddMarker(id, data)
    if not ZonesListe[id] then 
        ZonesListe[id] = data
    end
end

function RemoveMarker(id)
    ZonesListe[id] = nil
end

Citizen.CreateThread(function()
    for _,marker in pairs(ZonesListe) do
        if marker.Blip then
            local blip = AddBlipForCoord(marker.Position)

            SetBlipSprite(blip, marker.Blip.Sprite)
            SetBlipScale(blip, marker.Blip.Scale)
            SetBlipColour(blip, marker.Blip.Color)
            SetBlipDisplay(blip, marker.Blip.Display)
            SetBlipAsShortRange(blip, true)
    
            BeginTextCommandSetBlipName('STRING')
            AddTextComponentSubstringPlayerName(marker.Blip.Name)
            EndTextCommandSetBlipName(blip)
        end
	end

    while true do
        local isProche = false
        for k,v in pairs(ZonesListe) do
            if v.Public or ESX.PlayerData.job ~= nil and ESX.PlayerData.job.name == v.Job or ESX.PlayerData.job2.name == v.Job2 then
                local dist = Vdist2(GetEntityCoords(PlayerPedId(), false), v.Position)

                if dist < 20 then
                    isProche = true
                    DrawMarker(27, v.Position.x, v.Position.y, v.Position.z-0.89, 0.0, 0.0, -90.0, -90.0, 0.0, 0.0, 0.55, 0.55, 0.55, 0, 150, 255, 255, false, false, 2, false, false, false, false)
                end
                if dist < 3 then
                    Draw3DText(v.Position.x, v.Position.y, v.Position.z, "Appuyez sur ~b~E~s~ pour accéder au menu")
                    if IsControlJustPressed(1,51) then
                        v.Action(v.Position)
                    end
                end
            end
        end
        
		if isProche then
			Wait(0)
		else
			Wait(750)
		end
	end
end)

function KeyboardInput(entryTitle, textEntry, inputText, maxLength)
	AddTextEntry(entryTitle, textEntry)
	DisplayOnscreenKeyboard(1, entryTitle, '', inputText, '', '', '', 100)
	blockinput = true

	while UpdateOnscreenKeyboard() ~= 1 and UpdateOnscreenKeyboard() ~= 2 do
		Citizen.Wait(0)
	end

	if UpdateOnscreenKeyboard() ~= 2 then
		local result = GetOnscreenKeyboardResult()
		Citizen.Wait(500)
		blockinput = false
		return result
	else
		Citizen.Wait(500)
		blockinput = false
		return nil
	end
end

function Draw3DText(x, y, z, text)
    local onScreen, _x, _y = World3dToScreen2d(x, y, z)
    local p = GetGameplayCamCoords()
    local distance = GetDistanceBetweenCoords(p.x, p.y, p.z, x, y, z, 1)
    local scale = (1 / distance) * 2
    local fov = (1 / GetGameplayCamFov()) * 100
    local scale = scale * fov
    if onScreen then
        SetTextScale(0.0, 0.35)
        SetTextFont(0)
        SetTextProportional(1)
        SetTextColour(255, 255, 255, 255)
        SetTextDropshadow(0, 0, 0, 0, 255)
        SetTextEdge(2, 0, 0, 0, 150)
        SetTextDropShadow()
        SetTextOutline()
        SetTextEntry("STRING")
        SetTextCentre(1)
        AddTextComponentString(text)
        DrawText(_x,_y)
    end
end


--Create blips 


Citizen.CreateThread(function()
    local blip = AddBlipForCoord(-48.2, -1382.9, 29.3)
    SetBlipSprite(blip, 488)
    SetBlipDisplay(blip, 4)
    SetBlipScale(blip, 0.8)
    SetBlipColour(blip, 47)
    SetBlipAsShortRange(blip, true)
    BeginTextCommandSetBlipName("STRING")
    AddTextComponentString("Basketball")
    EndTextCommandSetBlipName(blip)
end)